'use strict';

var util = require('util'),
    should = require('should'),
    async = require('async'),
    _ = require('underscore');

var referrer = require('../lib/referrer');
var cases = require('./data/referrers');

describe('Referrer', function() {

    it('should parse referrer urls correctly', function(done) {
        async.forEach(cases, function(item, callback) {
            referrer.parse(item.referrer, function(result) {
                should.exist(result);
                var equal = _.isEqual(result, item.output);
                if (!equal) {
                    result.should.equal(item.output);
                } else {
                    console.log('\n' + '----- Test Case Passed -----');
                    console.log('REFERRER: ' + item.referrer);
                    console.log('EXPECTED: ');
                    console.dir(item.output);
                    console.log('GOT: ');
                    console.log(result);
                    console.log('-------------------------');
                    console.log('\n');
                }
            });
            callback();
        }, done);
    });

});